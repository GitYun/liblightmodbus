<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>liblightmodbus: Slave device</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">liblightmodbus
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">A lightweight, header-only, cross-platform Modbus RTU/TCP library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('slave.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Slave device </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In order to use slave side functions, make sure to define <code>LIGHTMODBUS_SLAVE</code> macro before including the library. Please also see <a class="el" href="building.html">Building and integrating liblightmodbus</a> for more information.</p>
<h1><a class="anchor" id="slave-init"></a>
Slave initialization</h1>
<p>Slave device state is represented by <a class="el" href="structModbusSlave.html" title="Slave device status.">ModbusSlave</a> structure. It must be initialized with <a class="el" href="slave_8h.html#aa48a592d418b5d822e25814ad048d954" title="Initializes slave device.">modbusSlaveInit()</a> before it is used: </p><div class="fragment"><div class="line"><a class="code" href="structModbusSlave.html">ModbusSlave</a> slave;</div>
<div class="line"><a class="code" href="structModbusErrorInfo.html">ModbusErrorInfo</a> err;</div>
<div class="line">err = <a class="code" href="slave_8h.html#aa48a592d418b5d822e25814ad048d954">modbusSlaveInit</a>(</div>
<div class="line">    &amp;slave,          </div>
<div class="line">    1,                               <span class="comment">// Address of the slave</span></div>
<div class="line">    <a class="code" href="slave_8h.html#afea4c9a9b7c29a34aa1674429bf7a5df">modbusSlaveDefaultAllocator</a>,     <span class="comment">// Memory allocator for ModbusSlave</span></div>
<div class="line">    myRegisterCallback,              <span class="comment">// Callback for register operations</span></div>
<div class="line">    myExceptionCallback,             <span class="comment">// Callback for handling slave exceptions (optional)</span></div>
<div class="line">    <a class="code" href="slave_8h.html#a0c75d5358eca0b3d71261269c55870d3">modbusSlaveDefaultFunctions</a>,     <span class="comment">// Set of supported functions</span></div>
<div class="line">    <a class="code" href="slave_8h.html#a1ed4f578aa9ac64591f7da2a50aca910">modbusSlaveDefaultFunctionCount</a>  <span class="comment">// Number of supported functions</span></div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check for errors</span></div>
<div class="line">assert(<a class="code" href="base_8h.html#a64880e7075f445881485396f3aa869c5">modbusIsOk</a>(err) &amp;&amp; <span class="stringliteral">&quot;modbusSlaveInit() failed&quot;</span>); </div>
<div class="ttc" id="abase_8h_html_a64880e7075f445881485396f3aa869c5"><div class="ttname"><a href="base_8h.html#a64880e7075f445881485396f3aa869c5">modbusIsOk</a></div><div class="ttdeci">static uint8_t modbusIsOk(ModbusErrorInfo err)</div><div class="ttdoc">Checks if ModbusErrorInfo contains an error.</div><div class="ttdef"><b>Definition:</b> base.h:349</div></div>
<div class="ttc" id="aslave_8h_html_a0c75d5358eca0b3d71261269c55870d3"><div class="ttname"><a href="slave_8h.html#a0c75d5358eca0b3d71261269c55870d3">modbusSlaveDefaultFunctions</a></div><div class="ttdeci">ModbusSlaveFunctionHandler modbusSlaveDefaultFunctions[]</div><div class="ttdoc">Associates function IDs with pointers to functions responsible for parsing. Length of this array is s...</div><div class="ttdef"><b>Definition:</b> slave.impl.h:10</div></div>
<div class="ttc" id="aslave_8h_html_a1ed4f578aa9ac64591f7da2a50aca910"><div class="ttname"><a href="slave_8h.html#a1ed4f578aa9ac64591f7da2a50aca910">modbusSlaveDefaultFunctionCount</a></div><div class="ttdeci">const uint8_t modbusSlaveDefaultFunctionCount</div><div class="ttdoc">Stores length of modbusSlaveDefaultFunctions.</div><div class="ttdef"><b>Definition:</b> slave.impl.h:52</div></div>
<div class="ttc" id="aslave_8h_html_aa48a592d418b5d822e25814ad048d954"><div class="ttname"><a href="slave_8h.html#aa48a592d418b5d822e25814ad048d954">modbusSlaveInit</a></div><div class="ttdeci">ModbusErrorInfo modbusSlaveInit(ModbusSlave *status, uint8_t address, ModbusSlaveAllocator allocator, ModbusRegisterCallback registerCallback, ModbusSlaveExceptionCallback exceptionCallback, const ModbusSlaveFunctionHandler *functions, uint8_t functionCount)</div><div class="ttdoc">Initializes slave device.</div><div class="ttdef"><b>Definition:</b> slave.impl.h:128</div></div>
<div class="ttc" id="aslave_8h_html_afea4c9a9b7c29a34aa1674429bf7a5df"><div class="ttname"><a href="slave_8h.html#afea4c9a9b7c29a34aa1674429bf7a5df">modbusSlaveDefaultAllocator</a></div><div class="ttdeci">ModbusError modbusSlaveDefaultAllocator(ModbusSlave *status, uint8_t **ptr, uint16_t size, ModbusBufferPurpose purpose)</div><div class="ttdoc">Default allocator for the slave based on modbusDefaultAllocator().</div><div class="ttdef"><b>Definition:</b> slave.impl.h:62</div></div>
<div class="ttc" id="astructModbusErrorInfo_html"><div class="ttname"><a href="structModbusErrorInfo.html">ModbusErrorInfo</a></div><div class="ttdoc">Richer error represenation - source and type of error.</div><div class="ttdef"><b>Definition:</b> base.h:90</div></div>
<div class="ttc" id="astructModbusSlave_html"><div class="ttname"><a href="structModbusSlave.html">ModbusSlave</a></div><div class="ttdoc">Slave device status.</div><div class="ttdef"><b>Definition:</b> slave.h:86</div></div>
</div><!-- fragment --><p><a class="el" href="structModbusSlave.html" title="Slave device status.">ModbusSlave</a> contains an internal buffer the response data. This buffer is allocated by the allocator passed to <a class="el" href="slave_8h.html#aa48a592d418b5d822e25814ad048d954" title="Initializes slave device.">modbusSlaveInit()</a>. modbusSlaveDefaultAllocator is a default allocator that uses malloc() and free() functions. You may write your own, more sophisticated allocators if you wish - please see <a class="el" href="allocators.html">Custom allocators</a> for more details.</p>
<p>In this code <code>myRegisterCallback</code> is a name of a callback function that will be called for every register operation. In previous this versions of the library this functionality was optionally available as <code>LIGHTMODBUS_REGISTER_CALLBACK</code>. Now, all register operations are performed using callbacks.</p>
<p><code>myExceptionCallback</code> is a name of a callback function that will be called every time slave reports an exception to the master. To disable this functionality, pass NULL as the callback.</p>
<p>The set of functions supported by the slave is determined by the 6th function argument - in this case <code>modbusSlaveDefaultFunctions</code>. This argument is a pointer to an array of <a class="el" href="structModbusSlaveFunctionHandler.html" title="Associates Modbus function ID with a pointer to a parsing function.">ModbusSlaveFunctionHandler</a> structures which associate function codes with callbacks. Lifetime of this array must not be shorter than thelifetime of the slave. The length of this array should be provided as the last argument.</p>
<h1><a class="anchor" id="slave-register-callback"></a>
Register callback</h1>
<p>An exapmple implementation of a register callback operating on registers stored in an array: </p><div class="fragment"><div class="line"><span class="preprocessor">#define REG_COUNT 16</span></div>
<div class="line"><span class="keyword">static</span> uint16_t registers[REG_COUNT];</div>
<div class="line"><span class="keyword">static</span> uint16_t inputRegisters[REG_COUNT];</div>
<div class="line"><span class="keyword">static</span> uint8_t coils[REG_COUNT / 8]; <span class="comment">// Each coil corresponds to one bit</span></div>
<div class="line"><span class="keyword">static</span> uint8_t discreteInputs[REG_COUNT / 8]; <span class="comment">// Each input corresponds to one bit</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6e">ModbusError</a> myRegisterCallback(</div>
<div class="line">    <a class="code" href="structModbusSlave.html">ModbusSlave</a> *status,</div>
<div class="line">    <span class="keyword">const</span> <a class="code" href="structModbusRegisterCallbackArgs.html">ModbusRegisterCallbackArgs</a> *args,</div>
<div class="line">    uint16_t *result)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Respond to read/write access queries</span></div>
<div class="line">    <span class="keywordflow">if</span> (args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#ac0bf7b5d09b8e5358d1233e446866d40">query</a> == <a class="code" href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca68672dc5badc4bd15dd12c168502930d">MODBUS_REGQ_R_CHECK</a> || args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#ac0bf7b5d09b8e5358d1233e446866d40">query</a> == <a class="code" href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca0c01fdc7e834c204e355a160790b9932">MODBUS_REGQ_W_CHECK</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// If result of a read/write access query is not 0,</span></div>
<div class="line">        <span class="comment">// an exception is reported by the slave</span></div>
<div class="line">        *result = args-&gt;id &lt; REG_COUNT ? <a class="code" href="base_8h.html#a0b7f726dfaa2b4cf98aaaed1eb42fa72a9b1d7542c51969c3fa21c8f440e849b6">MODBUS_EXCEP_NONE</a> : <a class="code" href="base_8h.html#a0b7f726dfaa2b4cf98aaaed1eb42fa72a24c0a052194534fbcaae038eb52dbb34">MODBUS_EXCEP_ILLEGAL_ADDRESS</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#ac0bf7b5d09b8e5358d1233e446866d40">query</a> == <a class="code" href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca6b80870bbce488af3b4d8ae43e8b3308">MODBUS_REGQ_R</a>) <span class="comment">// Read registers</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">switch</span> (args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#a63a0bf455e6cf9bd078e28df72c2b740">type</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112a399936691314c8b570aa8b8aa7742d0a">MODBUS_HOLDING_REGISTER</a>: *result = registers[args-&gt;id]; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112a8c7413b96e4656037480902e88d1d784">MODBUS_INPUT_REGISTER</a>:   *result = inputRegsiters[args-&gt;id]; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112adc8efd22a9222da954897e0f5925072b">MODBUS_COIL</a>:             *result = <a class="code" href="base_8h.html#aff2248343762719cdacf818e4dae3709">modbusMaskRead</a>(coils, args-&gt;id); <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112a14cdbb2f2145e4cf91f671072aeb9521">MODBUS_DISCRETE_INPUT</a>:   *result = <a class="code" href="base_8h.html#aff2248343762719cdacf818e4dae3709">modbusMaskRead</a>(discreteInputs, args-&gt;id); <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <a class="code" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6ea867896b7a63055286dd5f0dc6a9020e2">MODBUS_ERROR_OTHER</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#ac0bf7b5d09b8e5358d1233e446866d40">query</a> == <a class="code" href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca3d41fd03043bb3eb8332e2fc55f208a1">MODBUS_REGQ_W</a>) <span class="comment">// Write registers</span></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">switch</span> (args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#a63a0bf455e6cf9bd078e28df72c2b740">type</a>)</div>
<div class="line">        {</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112a399936691314c8b570aa8b8aa7742d0a">MODBUS_HOLDING_REGISTER</a>: registers[args-&gt;id] = args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#a3a33e19899353f94fede91e2b6259e90">value</a>; <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">case</span> <a class="code" href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112adc8efd22a9222da954897e0f5925072b">MODBUS_COIL</a>:             <a class="code" href="base_8h.html#a5d9947eb500e2d0c87491a0adce53c2a">modbusMaskWrite</a>(coils, args-&gt;id, args-&gt;<a class="code" href="structModbusRegisterCallbackArgs.html#a3a33e19899353f94fede91e2b6259e90">value</a>); <span class="keywordflow">break</span>;</div>
<div class="line">            <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <a class="code" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6ea867896b7a63055286dd5f0dc6a9020e2">MODBUS_ERROR_OTHER</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6ea867896b7a63055286dd5f0dc6a9020e2">MODBUS_ERROR_OTHER</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Return MODBUS_OK on success</span></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6eafbb178df49063323a6dcbf03dd0d88d2">MODBUS_OK</a>;</div>
<div class="line">}</div>
<div class="ttc" id="abase_8h_html_a0b7f726dfaa2b4cf98aaaed1eb42fa72a24c0a052194534fbcaae038eb52dbb34"><div class="ttname"><a href="base_8h.html#a0b7f726dfaa2b4cf98aaaed1eb42fa72a24c0a052194534fbcaae038eb52dbb34">MODBUS_EXCEP_ILLEGAL_ADDRESS</a></div><div class="ttdeci">@ MODBUS_EXCEP_ILLEGAL_ADDRESS</div><div class="ttdoc">Illegal data address.</div><div class="ttdef"><b>Definition:</b> base.h:199</div></div>
<div class="ttc" id="abase_8h_html_a0b7f726dfaa2b4cf98aaaed1eb42fa72a9b1d7542c51969c3fa21c8f440e849b6"><div class="ttname"><a href="base_8h.html#a0b7f726dfaa2b4cf98aaaed1eb42fa72a9b1d7542c51969c3fa21c8f440e849b6">MODBUS_EXCEP_NONE</a></div><div class="ttdeci">@ MODBUS_EXCEP_NONE</div><div class="ttdef"><b>Definition:</b> base.h:197</div></div>
<div class="ttc" id="abase_8h_html_a2b4f849d9455a7247dd9a0c1dee46112a14cdbb2f2145e4cf91f671072aeb9521"><div class="ttname"><a href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112a14cdbb2f2145e4cf91f671072aeb9521">MODBUS_DISCRETE_INPUT</a></div><div class="ttdeci">@ MODBUS_DISCRETE_INPUT</div><div class="ttdoc">Discrete input.</div><div class="ttdef"><b>Definition:</b> base.h:214</div></div>
<div class="ttc" id="abase_8h_html_a2b4f849d9455a7247dd9a0c1dee46112a399936691314c8b570aa8b8aa7742d0a"><div class="ttname"><a href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112a399936691314c8b570aa8b8aa7742d0a">MODBUS_HOLDING_REGISTER</a></div><div class="ttdeci">@ MODBUS_HOLDING_REGISTER</div><div class="ttdoc">Holding register.</div><div class="ttdef"><b>Definition:</b> base.h:211</div></div>
<div class="ttc" id="abase_8h_html_a2b4f849d9455a7247dd9a0c1dee46112a8c7413b96e4656037480902e88d1d784"><div class="ttname"><a href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112a8c7413b96e4656037480902e88d1d784">MODBUS_INPUT_REGISTER</a></div><div class="ttdeci">@ MODBUS_INPUT_REGISTER</div><div class="ttdoc">Input register.</div><div class="ttdef"><b>Definition:</b> base.h:212</div></div>
<div class="ttc" id="abase_8h_html_a2b4f849d9455a7247dd9a0c1dee46112adc8efd22a9222da954897e0f5925072b"><div class="ttname"><a href="base_8h.html#a2b4f849d9455a7247dd9a0c1dee46112adc8efd22a9222da954897e0f5925072b">MODBUS_COIL</a></div><div class="ttdeci">@ MODBUS_COIL</div><div class="ttdoc">Coil.</div><div class="ttdef"><b>Definition:</b> base.h:213</div></div>
<div class="ttc" id="abase_8h_html_a3e91ea9ea1b4d5927573e6ec1d1cce6e"><div class="ttname"><a href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6e">ModbusError</a></div><div class="ttdeci">ModbusError</div><div class="ttdoc">Represtents different kinds of errors.</div><div class="ttdef"><b>Definition:</b> base.h:99</div></div>
<div class="ttc" id="abase_8h_html_a3e91ea9ea1b4d5927573e6ec1d1cce6ea867896b7a63055286dd5f0dc6a9020e2"><div class="ttname"><a href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6ea867896b7a63055286dd5f0dc6a9020e2">MODBUS_ERROR_OTHER</a></div><div class="ttdeci">@ MODBUS_ERROR_OTHER</div><div class="ttdoc">Other error.</div><div class="ttdef"><b>Definition:</b> base.h:189</div></div>
<div class="ttc" id="abase_8h_html_a3e91ea9ea1b4d5927573e6ec1d1cce6eafbb178df49063323a6dcbf03dd0d88d2"><div class="ttname"><a href="base_8h.html#a3e91ea9ea1b4d5927573e6ec1d1cce6eafbb178df49063323a6dcbf03dd0d88d2">MODBUS_OK</a></div><div class="ttdeci">@ MODBUS_OK</div><div class="ttdoc">No error.</div><div class="ttdef"><b>Definition:</b> base.h:105</div></div>
<div class="ttc" id="abase_8h_html_a5d9947eb500e2d0c87491a0adce53c2a"><div class="ttname"><a href="base_8h.html#a5d9947eb500e2d0c87491a0adce53c2a">modbusMaskWrite</a></div><div class="ttdeci">static void modbusMaskWrite(uint8_t *mask, uint16_t n, uint8_t value)</div><div class="ttdoc">Writes n-th bit in an array.</div><div class="ttdef"><b>Definition:</b> base.h:263</div></div>
<div class="ttc" id="abase_8h_html_aff2248343762719cdacf818e4dae3709"><div class="ttname"><a href="base_8h.html#aff2248343762719cdacf818e4dae3709">modbusMaskRead</a></div><div class="ttdeci">static uint8_t modbusMaskRead(const uint8_t *mask, uint16_t n)</div><div class="ttdoc">Reads n-th bit from an array.</div><div class="ttdef"><b>Definition:</b> base.h:252</div></div>
<div class="ttc" id="aslave_8h_html_af3b062fa65ce1ab33f86b8cbc9d250bca0c01fdc7e834c204e355a160790b9932"><div class="ttname"><a href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca0c01fdc7e834c204e355a160790b9932">MODBUS_REGQ_W_CHECK</a></div><div class="ttdeci">@ MODBUS_REGQ_W_CHECK</div><div class="ttdoc">Request for write access.</div><div class="ttdef"><b>Definition:</b> slave.h:35</div></div>
<div class="ttc" id="aslave_8h_html_af3b062fa65ce1ab33f86b8cbc9d250bca3d41fd03043bb3eb8332e2fc55f208a1"><div class="ttname"><a href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca3d41fd03043bb3eb8332e2fc55f208a1">MODBUS_REGQ_W</a></div><div class="ttdeci">@ MODBUS_REGQ_W</div><div class="ttdoc">Write request.</div><div class="ttdef"><b>Definition:</b> slave.h:37</div></div>
<div class="ttc" id="aslave_8h_html_af3b062fa65ce1ab33f86b8cbc9d250bca68672dc5badc4bd15dd12c168502930d"><div class="ttname"><a href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca68672dc5badc4bd15dd12c168502930d">MODBUS_REGQ_R_CHECK</a></div><div class="ttdeci">@ MODBUS_REGQ_R_CHECK</div><div class="ttdoc">Request for read access.</div><div class="ttdef"><b>Definition:</b> slave.h:34</div></div>
<div class="ttc" id="aslave_8h_html_af3b062fa65ce1ab33f86b8cbc9d250bca6b80870bbce488af3b4d8ae43e8b3308"><div class="ttname"><a href="slave_8h.html#af3b062fa65ce1ab33f86b8cbc9d250bca6b80870bbce488af3b4d8ae43e8b3308">MODBUS_REGQ_R</a></div><div class="ttdeci">@ MODBUS_REGQ_R</div><div class="ttdoc">Read request.</div><div class="ttdef"><b>Definition:</b> slave.h:36</div></div>
<div class="ttc" id="astructModbusRegisterCallbackArgs_html"><div class="ttname"><a href="structModbusRegisterCallbackArgs.html">ModbusRegisterCallbackArgs</a></div><div class="ttdoc">Contains arguments for the register callback function.</div><div class="ttdef"><b>Definition:</b> slave.h:44</div></div>
<div class="ttc" id="astructModbusRegisterCallbackArgs_html_a3a33e19899353f94fede91e2b6259e90"><div class="ttname"><a href="structModbusRegisterCallbackArgs.html#a3a33e19899353f94fede91e2b6259e90">ModbusRegisterCallbackArgs::value</a></div><div class="ttdeci">uint16_t value</div><div class="ttdoc">Value of the register.</div><div class="ttdef"><b>Definition:</b> slave.h:48</div></div>
<div class="ttc" id="astructModbusRegisterCallbackArgs_html_a63a0bf455e6cf9bd078e28df72c2b740"><div class="ttname"><a href="structModbusRegisterCallbackArgs.html#a63a0bf455e6cf9bd078e28df72c2b740">ModbusRegisterCallbackArgs::type</a></div><div class="ttdeci">ModbusDataType type</div><div class="ttdoc">Type of accessed data.</div><div class="ttdef"><b>Definition:</b> slave.h:45</div></div>
<div class="ttc" id="astructModbusRegisterCallbackArgs_html_ac0bf7b5d09b8e5358d1233e446866d40"><div class="ttname"><a href="structModbusRegisterCallbackArgs.html#ac0bf7b5d09b8e5358d1233e446866d40">ModbusRegisterCallbackArgs::query</a></div><div class="ttdeci">ModbusRegisterQuery query</div><div class="ttdoc">Type of request made to the register.</div><div class="ttdef"><b>Definition:</b> slave.h:46</div></div>
</div><!-- fragment --><h1><a class="anchor" id="slave-exception-callback"></a>
Slave exception callback</h1>
<dl class="section note"><dt>Note</dt><dd>Returning error values different than MODBUS_OK from the callback will result in MODBUS_EXCEP_SLAVE_FAILURE exception being reported to the master.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Complete this section</dd></dl>
<h1><a class="anchor" id="slave-requests"></a>
Request processing</h1>
<dl class="section note"><dt>Note</dt><dd>Return values from this callback are ignored. This functionality, however, should not be relied upon and may be subject to change in future releases.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>Complete this section</dd></dl>
<p>After successful initialization of the slave device, it's ready to accept requests from the master: </p><div class="fragment"><div class="line"><span class="comment">// For Modbus RTU</span></div>
<div class="line"><a class="code" href="structModbusErrorInfo.html">ModbusErrorInfo</a> err;</div>
<div class="line">err = <a class="code" href="slave_8h.html#a28b9fe2f4559cd0b1c39aff30099d591">modbusParseRequestRTU</a>(&amp;slave, buffer, length);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Handle &#39;serious&#39; errors such as memory allocation problems</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="base_8h.html#a84765449265aa5a31877b749f04cb568">modbusGetGeneralError</a>(&amp;slave))</div>
<div class="line">    handleSlaveError(err);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Handle errors related to the structure of the request frame</span></div>
<div class="line"><span class="comment">// for example invalid CRC</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="base_8h.html#a5c6f792a259423b2df55d8d49e91fd06">modbusGetRequestError</a>(&amp;slave))</div>
<div class="line">    handleRequesterrors(err);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// If the function did not return an error, the response is ready to be sent</span></div>
<div class="line"><span class="comment">// to master. The response frame is located inside ModbusSlave at ModbusSlave::response::data</span></div>
<div class="line"><span class="comment">// and is ModbusSlave::response::length bytes long. Beware that response frame can be empty</span></div>
<div class="line"><span class="comment">// in some cases!</span></div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="base_8h.html#a64880e7075f445881485396f3aa869c5">modbusIsOk</a>(err))</div>
<div class="line">    sendToMaster(slave.<a class="code" href="structModbusSlave.html#a6db3d15f4074b75c6c7a7d345b418592">response</a>.<a class="code" href="structModbusFrameBuffer.html#aeb768ff03dc94f043a99adb5405c21e1">data</a>, slave.<a class="code" href="structModbusSlave.html#a6db3d15f4074b75c6c7a7d345b418592">response</a>.<a class="code" href="structModbusFrameBuffer.html#a78957366a4822aa584702054a38c58b6">length</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Optionally, the response buffer can be freed now</span></div>
<div class="line"><a class="code" href="slave_8h.html#a5e517b65cb8b32010146fa80b78bc848">modbusSlaveFreeResponse</a>(&amp;slave);</div>
<div class="ttc" id="abase_8h_html_a5c6f792a259423b2df55d8d49e91fd06"><div class="ttname"><a href="base_8h.html#a5c6f792a259423b2df55d8d49e91fd06">modbusGetRequestError</a></div><div class="ttdeci">static ModbusError modbusGetRequestError(ModbusErrorInfo err)</div><div class="ttdoc">Returns request error from ModbusErrorInfo.</div><div class="ttdef"><b>Definition:</b> base.h:369</div></div>
<div class="ttc" id="abase_8h_html_a84765449265aa5a31877b749f04cb568"><div class="ttname"><a href="base_8h.html#a84765449265aa5a31877b749f04cb568">modbusGetGeneralError</a></div><div class="ttdeci">static ModbusError modbusGetGeneralError(ModbusErrorInfo err)</div><div class="ttdoc">Returns general error from ModbusErrorInfo.</div><div class="ttdef"><b>Definition:</b> base.h:359</div></div>
<div class="ttc" id="aslave_8h_html_a28b9fe2f4559cd0b1c39aff30099d591"><div class="ttname"><a href="slave_8h.html#a28b9fe2f4559cd0b1c39aff30099d591">modbusParseRequestRTU</a></div><div class="ttdeci">ModbusErrorInfo modbusParseRequestRTU(ModbusSlave *status, const uint8_t *request, uint16_t requestLength)</div><div class="ttdoc">Parses provided Modbus RTU request frame and generates a Modbus RTU response.</div><div class="ttdef"><b>Definition:</b> slave.impl.h:276</div></div>
<div class="ttc" id="aslave_8h_html_a5e517b65cb8b32010146fa80b78bc848"><div class="ttname"><a href="slave_8h.html#a5e517b65cb8b32010146fa80b78bc848">modbusSlaveFreeResponse</a></div><div class="ttdeci">void modbusSlaveFreeResponse(ModbusSlave *status)</div><div class="ttdoc">Frees memory allocated for slave's response frame.</div><div class="ttdef"><b>Definition:</b> slave.impl.h:107</div></div>
<div class="ttc" id="astructModbusFrameBuffer_html_a78957366a4822aa584702054a38c58b6"><div class="ttname"><a href="structModbusFrameBuffer.html#a78957366a4822aa584702054a38c58b6">ModbusFrameBuffer::length</a></div><div class="ttdeci">uint16_t length</div><div class="ttdoc">Length of the entire frame (PDU size + padding)</div><div class="ttdef"><b>Definition:</b> base.h:233</div></div>
<div class="ttc" id="astructModbusFrameBuffer_html_aeb768ff03dc94f043a99adb5405c21e1"><div class="ttname"><a href="structModbusFrameBuffer.html#aeb768ff03dc94f043a99adb5405c21e1">ModbusFrameBuffer::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdoc">Pointer to the frame buffer.</div><div class="ttdef"><b>Definition:</b> base.h:231</div></div>
<div class="ttc" id="astructModbusSlave_html_a6db3d15f4074b75c6c7a7d345b418592"><div class="ttname"><a href="structModbusSlave.html#a6db3d15f4074b75c6c7a7d345b418592">ModbusSlave::response</a></div><div class="ttdeci">ModbusFrameBuffer response</div><div class="ttdoc">Stores slave's response to master.</div><div class="ttdef"><b>Definition:</b> slave.h:96</div></div>
</div><!-- fragment --><h1><a class="anchor" id="slave-cleanup"></a>
Slave cleanup</h1>
<p>In order to destroy the <a class="el" href="structModbusSlave.html" title="Slave device status.">ModbusSlave</a> structure, simply call <a class="el" href="slave_8h.html#a70695c3b7355bc0a3e6d49c46a4eef1f" title="Frees memory allocated in the ModbusSlave struct.">modbusSlaveDestroy()</a>: </p><div class="fragment"><div class="line"><a class="code" href="slave_8h.html#a70695c3b7355bc0a3e6d49c46a4eef1f">modbusSlaveDestroy</a>(&amp;slave);</div>
<div class="ttc" id="aslave_8h_html_a70695c3b7355bc0a3e6d49c46a4eef1f"><div class="ttname"><a href="slave_8h.html#a70695c3b7355bc0a3e6d49c46a4eef1f">modbusSlaveDestroy</a></div><div class="ttdeci">void modbusSlaveDestroy(ModbusSlave *status)</div><div class="ttdoc">Frees memory allocated in the ModbusSlave struct.</div><div class="ttdef"><b>Definition:</b> slave.impl.h:156</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
